/**
 * Javascript controller for controlling the sections.
 *
 * @module     local_my/local_my
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("theme_klassplace/local_my_on_site",["jquery","core/config","core/log"],(function($,cfg,log){var localmy={usereloadwaiter:!1,init:function(){$("#page-site-index").on("click",".local-my-cat-collapse",[],this.toggle_cat_state),$("#page-site-index").on("change",".local-my-modality-chooser",[],this.toggle_modality),$("#page-site-index").on("click",".local-my-area-ctls",[],this.global_area_ctl),$("#page-site-index").on("click",".detail-handle",[],this.toggle_detail),$("#page-site-index").on("click",".add-to-favorites-handle",[],this.add_to_favorites),$("#page-site-index").on("click",".remove-from-favorites-handle",[],this.remove_from_favorites),$("#page-site-index").on("click",".course-filter",[],this.refresh_course_list),$("#page-site-index").on("click",".course-sort",[],this.refresh_course_list),$("#page-site-index").on("click",".course-display",[],this.refresh_course_list),$("#page-site-index").on("click",".course-time",[],this.refresh_course_list),$("#page-site-index").on("click",".reload-areas",[],this.refresh_course_list),0!==$(".is-accordion").length&&($(".is-accordion .local-my-course").hide(),$(".is-accordion .local-my-cat-collapse > h3 > a").attr("aria-expanded","false")),$(".reload-areas").each((function(){log.debug("Launching refresh on "+$(this).attr("data-widget")+"-"+$(this).attr("data-uid")),$(this).trigger("click")})),this.usereloadwaiter=!0,log.debug("AMD Local My On site Page initialized")},postreset:function(){0!==$(".is-accordion").length&&($(".is-accordion .local-my-course").hide(),$(".is-accordion .local-my-cat-collapse > h3 > a").attr("aria-expanded","false"))},hide_home_nav:function(){$('a[data-key="home"]').css("display","none")},toggle_cat_state:function(e){e.stopPropagation(),e.preventDefault();var that=$(this),matchs=/local-my-cathandle-([^-]+)-([0-9]+)/.exec(that.attr("id"));if(matchs){var area=matchs[1],catid=parseInt(matchs[2]);if(log.debug("Working for cat "+catid+" in area "+area),0===that.closest(".is-accordion").length){var url=cfg.wwwroot+"/local/my/ajax/stateregister.php?";url+="item="+area,url+="&catid="+catid;var hide=0;$(".local-my-course-"+area+".cat-"+area+"-"+catid).first().hasClass("collapsed")?($(".local-my-course-"+area+".cat-"+area+"-"+catid).removeClass("collapsed"),$("#local-my-cathandle-"+area+"-"+catid+" > h3 > a").attr("aria-expanded","true"),log.debug("Expanding "+area+" in area "+catid),hide=0):($(".local-my-course-"+area+".cat-"+area+"-"+catid).addClass("collapsed"),$("#local-my-cathandle-"+area+"-"+catid+" > h3 > a").attr("aria-expanded","false"),log.debug("Closing "+area+" in area "+catid),hide=1),url+="&hide="+hide,$.get(url,(function(){}))}else $(".local-my-course-"+area).slideUp("normal"),$(".local-my-cat-collapse-"+area+" > h3 > a").attr("aria-expanded","false"),$(".local-my-course-"+area+".cat-"+area+"-"+catid).slideDown("normal"),$("#local-my-cathandle-"+area+"-"+catid+" > h3 > a").attr("aria-expanded","true");return!1}},toggle_modality:function(){var that=$(this),modalityid=that.attr("id").replace("local-my-static-select-","local-my-static-modal-");$(".local-my-statictext-modals").addClass("local-my-hide"),$("#"+modalityid+"-"+that.val()).removeClass("local-my-hide")},toggle_detail:function(e){e.stopPropagation(),e.preventDefault();var that=$(this),panelid="#details-indicators-"+that.attr("id").replace("detail-handle-","");return"none"===$(panelid).css("display")?($(panelid).css("display","flex"),that.attr("aria-expanded",!0),that.children("i").removeClass("fa-caret-down"),that.children("i").addClass("fa-caret-up")):($(panelid).css("display","none"),that.attr("aria-expanded",!1),that.children("i").removeClass("fa-caret-up"),that.children("i").addClass("fa-caret-down")),!1},global_area_ctl:function(e){var that=$(this);e.stopPropagation(),e.preventDefault();var matches=that.attr("id").match(/local-my-cats-([^-]+)-([^-]+)$/);if(matches){var mode=matches[1],area=matches[2],url="";return"collapseall"==mode?($(".local-my-course-"+area).addClass("collapsed"),$(".local-my-cat-collapse-"+area+" > h3 > button > img").each((function(index,element){var handlesrc=element.src;handlesrc=handlesrc.replace("expanded","collapsed"),element.src=handlesrc})),url=cfg.wwwroot+"/local/my/ajax/stateregister.php?",url+="item="+area,url+="&catids="+$("#local-my-areacategories-"+area).html(),url+="&what=collapseall",$.get(url)):($(".local-my-course-"+area).removeClass("collapsed"),$(".local-my-cat-collapse-"+area+" > h3 > button > img").each((function(index,element){var handlesrc=element.src;handlesrc=handlesrc.replace("collapsed","expanded"),element.src=handlesrc})),url=cfg.wwwroot+"/local/my/ajax/stateregister.php?",url+="item="+area,url+="&catids="+$("#local-my-areacategories-"+area).html(),url+="&what=expandall",$.get(url)),!1}},sektor:function(args){"color"in args||(args.color="#bb3030"),"circlecolor"in args||(args.circlecolor="#ddd"),log.debug("Sektor refresh on "+args.id);new Sektor(args.id,{size:args.size,stroke:0,arc:!1,angle:args.angle,sectorColor:args.color,circleColor:args.circlecolor,fillCircle:!0})},add_to_favorites:function(){var that=$(this),courseid=that.attr("data-course"),islight=that.hasClass("light"),url=cfg.wwwroot+"/local/my/ajax/service.php";url+="?what=addtofavorites",url+="&courseid="+courseid,that.removeClass("fa-star-o"),that.addClass("fa-star"),islight&&(that.removeClass("add-to-favorites-handle"),that.addClass("remove-from-favorites-handle")),log.debug("Adding course "+courseid+" to favorites"),$.get(url);var favorites=$(".favorite-courses");favorites.length&&favorites.each((function(){$(this).children(".reload-areas").trigger("click")}))},remove_from_favorites:function(){var that=$(this),courseid=that.attr("data-course"),islight=that.hasClass("light"),url=cfg.wwwroot+"/local/my/ajax/service.php";url+="?what=removefromfavorites",url+="&courseid="+courseid,log.debug("Removing course "+courseid+" from favorites"),$.get(url),$('.icon-favorite[data-course="'+courseid+'"]').removeClass("fa-star"),$('.icon-favorite[data-course="'+courseid+'"]').addClass("fa-star-o"),islight&&(that.removeClass("fa-star"),that.addClass("fa-star-o"),that.removeClass("remove-from-favorites-handle"),that.addClass("add-to-favorites-handle"));var favorites=$(".favorite-courses");favorites.length&&favorites.each((function(){$(this).children(".reload-areas").trigger("click")}))},refresh_course_list:function(){var that=$(this),uid=that.attr("data-uid"),view=that.attr("data-view"),widget=that.attr("data-widget");log.debug("Activating sort/filter/display option on "+uid);var currentdatafilter,filters=$(".course-filters-"+uid+".active"),url=cfg.wwwroot+"/local/my/ajax/service.php";if(url+="?what=getcourses",url+="&widget="+widget,url+="&uid="+uid,url+="&view="+view,that.attr("data-sort"))url+="&sort="+that.attr("data-sort");else{var activesort=$(".course-sort-"+uid+".active");activesort&&(url+="&sort="+activesort.attr("data-sort"))}if(that.attr("data-display"))url+="&display="+that.attr("data-display");else{var activedisplay=$(".course-display-"+uid+".active");activedisplay&&(url+="&display="+activedisplay.attr("data-display"))}if(that.attr("data-time"))url+="&schedule="+that.attr("data-time");else{var activetime=$(".course-time-"+uid+".active");activetime&&(url+="&schedule="+activetime.attr("data-time"))}if(that.attr("data-filter")&&(currentdatafilter=that.attr("data-filter"),url+="&"+that.attr("data-filter")+"="+that.attr("data-filter-value")),filters.length)for(var filter in filters)filter.attr("data-filter")!=currentdatafilter&&(url+="&"+filter.attr("data-filter")+"="+filter.attr("data-filter-value"));localmy.usereloadwaiter&&$("#content-"+uid).html('<img src="'+cfg.wwwroot+'/pix/i/loading.gif">'),$.get(url,(function(data){$("#area-courses-"+uid).html(data.html),$("#block_"+widget+"-"+uid+" .filter-states").html(data.filterstates)}),"json")}};return localmy}));

//# sourceMappingURL=local_my_on_site.min.js.map