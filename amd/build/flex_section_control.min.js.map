{"version":3,"file":"flex_section_control.min.js","sources":["../src/flex_section_control.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Javascript controller for controlling the sections.\n *\n * @module     theme_klassplace/flex_section_control\n * @package    theme_klassplace\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine(['jquery', 'core/config', 'core/log'], function($, config, log) {\n\n    /**\n     * SectionControl class.\n     *\n     * @param {String} selector The selector for the page region containing the actions panel.\n     */\n    var flexsection_control = {\n\n        courseid: 0,\n\n        init: function(attribs) {\n\n            this.courseid = attribs;\n\n            // Attach togglestate handler to all flexsections in page.\n            $('.flexcontrol').on('click', this.togglestate);\n            $('.section-caption').on('keydown', this.togglekeyreceiver);\n\n            // Attach global processings.\n            $('.flexsection-global-control').on('click', this.processglobal);\n\n            $('.flexsections > .section > .content > .sectionname').on('click', this.proxysectionnameevent);\n            log.debug('AMD Flex sections control initialized');\n        },\n\n        // Init_editing will NOT take control of section name.\n        init_editing: function(attribs) {\n\n            this.courseid = attribs;\n\n            // Expand everything.\n            $('.section.sub > .content > .section-content').css('display', 'block');\n            $('.section.sub > .content > .section-content').css('visibility', 'visible');\n            $('.section.sub > .content > .summary').css('display', 'block');\n            $('.section.sub > .content > .summary').css('visibility', 'visible');\n            $('.section.sub >.content > .flexsections').css('display', 'block');\n            $('.section.sub >.content > .flexsections').css('visibility', 'visible');\n            // $('.flexcontrol > img').attr('src', $('.flexcontrol > img').attr('src').replace('collapsed', 'expanded'));\n\n            // If collapse mode enabled in editing\n            // Attach togglestate handler to all flexsections in page.\n            $('.flexcontrol').on('click', this.togglestate);\n\n            // Attach global processings.\n            $('.flexsection-global-control').on('click', this.processglobal);\n\n            // Dim toggle buttons. (if collapse mode disabled in edting.\n\n            log.debug('AMD Flex sections control initialized v1.3');\n        },\n\n        proxysectionnameevent: function(e) {\n\n            e.stopPropagation();\n            e.preventDefault();\n            var handle = $(this).find('img');\n            handle.trigger('click');\n\n        },\n\n        togglestate: function(e, hide) {\n\n            e.stopPropagation();\n            e.preventDefault();\n            var that = $(this);\n\n            if (that.hasClass('sectioname')) {\n                var regex = /sectioname-([0-9]+)-section-([0-9]+)/;\n            } else {\n                var regex = /control-([0-9]+)-section-([0-9]+)/;\n            }\n            var matchs = regex.exec(that.attr('id'));\n            var sectionid = parseInt(matchs[1]);\n            var sectionsection = parseInt(matchs[2]);\n            regex = /level-([0-9]+)/;\n            matchs = regex.exec(that.attr('class'));\n            var level = parseInt(matchs[1]);\n\n            log.debug('Working for flex section ' + sectionsection + ' of id ' + sectionid);\n\n            var url = config.wwwroot + '/theme/klassplace/sections/ajax/register.php?';\n            url += 'sectionid=' + sectionid;\n            // var handlesrc = $('#control-' + sectionid + '-section-' + sectionsection + ' > img').attr('src');\n\n            if (!hide) {\n                var parentid = that.closest('li').parent().closest('li').attr('id');\n                // Trigger hide event on all siblings.\n                $.each($('#' + parentid + ' .flexcontrol.level-' + level), function(index, value) {\n                    if ($(value).attr('id') != that.attr('id')) {\n                        $(value).trigger('click', true);\n                    }\n                });\n            }\n\n            if (($('#section-' + sectionsection).hasClass('expanded')) ||\n                        (hide === true)) {\n                $('#section-' + sectionsection).addClass('collapsed');\n                $('#section-' + sectionsection).removeClass('expanded');\n                log.debug('Changing section #section-title-' + sectionsection + ' to false');\n                $('#section-title-' + sectionsection).attr('aria-expanded', 'false');\n                $('#section-' + sectionsection + ' > .content > .section-content').addClass('collpased');\n                $('#section-' + sectionsection + ' > .content > .section-content').removeClass('expanded');\n                // handlesrc = handlesrc.replace('expanded', 'collapsed');\n                // $('#control-' + sectionid + '-section-' + sectionsection + ' > img ').attr('src', handlesrc);\n                hide = 1;\n            } else {\n                // Show section.\n                $('#section-' + sectionsection).addClass('expanded');\n                $('#section-' + sectionsection).removeClass('collapsed');\n                log.debug('Changing section #section-title-' + sectionsection + ' to true');\n                $('#section-title-' + sectionsection).attr('aria-expanded', 'true');\n                $('#section-' + sectionsection + ' > .content > .section-content').addClass('expanded');\n                $('#section-' + sectionsection + ' > .content > .section-content').removeClass('collapsed');\n                // handlesrc = handlesrc.replace('collapsed', 'expanded');\n                // $('#control-' + sectionid + '-section-' + sectionsection + ' > img ').attr('src', handlesrc);\n                hide = 0;\n\n                // Scroll to this section.\n                var offset = that.offset();\n                offset.top -= 70;\n                $('html, body').animate({\n                    scrollTop: offset.top,\n                    scrollLeft: 0\n                });\n            }\n\n            url += '&hide=' + hide;\n\n            $.get(url, function() {\n            });\n\n            return false;\n        },\n\n        processglobal: function(e) {\n            e.stopPropagation();\n            e.preventDefault();\n            var that = $(this);\n\n            var regex = /flexsections-control-([a-z]+)/;\n            var matchs = regex.exec(that.attr('id'));\n            var what = matchs[1];\n\n            var url = config.wwwroot + '/theme/klassplace/sections/ajax/register.php?';\n            url += 'id=' + flexsection_control.courseid;\n            url += '&what=' + what;\n\n            switch (what) {\n                case 'collapseall':\n                    $('.section.sub').removeClass('expanded');\n                    $('.section.sub').addClass('collapsed');\n                    $('.section-content').addClass('collpased');\n                    $('.section-content').removeClass('expanded');\n                    $('.section-title').attr('aria-expanded', 'false');\n                    // $('.flexcontrol > img').attr('src', $('.flexcontrol > img').attr('src').replace('expanded', 'collapsed'));\n                    break;\n\n                case 'expandall':\n                    $('.section').removeClass('collapsed');\n                    $('.section').addClass('expanded');\n                    $('.section-content').addClass('expanded');\n                    $('.section-content').removeClass('collapsed');\n                    $('.section-title').attr('aria-expanded', 'true');\n                    // $('.flexcontrol > img').attr('src',$('.flexcontrol > img').attr('src').replace('collapsed', 'expanded'));\n                    break;\n\n                case 'map':\n                    $('.section').removeClass('collapsed');\n                    $('.section').addClass('expanded');\n                    $('.section-content').removeClass('expanded');\n                    $('.section-content').addClass('collapsed');\n                    $('.section-title').attr('aria-expanded', 'false');\n                    // Close leaves.\n                    $('.section.isleaf').addClass('expanded');\n                    $('.section.isleaf').removeClass('collapsed');\n                    $('.section.isleaf .section-title').attr('aria-expanded', 'true');\n            }\n\n            // Update positions server side.\n            $.get(url);\n        },\n\n        togglekeyreceiver: function(e) {\n            var that = $(this);\n            // Catch [enter] and [space]\n            if (e.keyCode == 13 || e.keyCode == 32) {\n                var sectionli = that.closest('li');\n                var sectionid = sectionli.attr('id').replace('section-', '');\n                var flexcontrol = that.find('#section-title-' + sectionid + ' > div.flexcontrol');\n                var toggleproxy = $.proxy(flexsection_control.togglestate, flexcontrol);\n                toggleproxy(e);\n            }\n        }\n    };\n\n    return flexsection_control;\n\n});\n"],"names":["define","$","config","log","flexsection_control","courseid","init","attribs","on","this","togglestate","togglekeyreceiver","processglobal","proxysectionnameevent","debug","init_editing","css","e","stopPropagation","preventDefault","find","trigger","hide","that","hasClass","regex","matchs","exec","attr","sectionid","parseInt","sectionsection","level","url","wwwroot","parentid","closest","parent","each","index","value","addClass","removeClass","offset","top","animate","scrollTop","scrollLeft","get","what","keyCode","replace","flexcontrol","proxy","toggleproxy"],"mappings":"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"}