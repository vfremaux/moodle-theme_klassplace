/**
 * Javascript controller for controlling the sections.
 *
 * @module     theme_klassplace/flex_section_control
 * @package    theme_klassplace
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("theme_klassplace/flex_section_control",["jquery","core/config","core/log"],(function($,config,log){var flexsection_control={courseid:0,init:function(attribs){this.courseid=attribs,$(".flexcontrol").on("click",this.togglestate),$(".section-caption").on("keydown",this.togglekeyreceiver),$(".flexsection-global-control").on("click",this.processglobal),$(".flexsections > .section > .content > .sectionname").on("click",this.proxysectionnameevent),log.debug("AMD Flex sections control initialized")},init_editing:function(attribs){this.courseid=attribs,$(".section.sub > .content > .section-content").css("display","block"),$(".section.sub > .content > .section-content").css("visibility","visible"),$(".section.sub > .content > .summary").css("display","block"),$(".section.sub > .content > .summary").css("visibility","visible"),$(".section.sub >.content > .flexsections").css("display","block"),$(".section.sub >.content > .flexsections").css("visibility","visible"),$(".flexcontrol").on("click",this.togglestate),$(".flexsection-global-control").on("click",this.processglobal),log.debug("AMD Flex sections control initialized v1.3")},proxysectionnameevent:function(e){e.stopPropagation(),e.preventDefault(),$(this).find("img").trigger("click")},togglestate:function(e,hide){e.stopPropagation(),e.preventDefault();var that=$(this);if(that.hasClass("sectioname"))var regex=/sectioname-([0-9]+)-section-([0-9]+)/;else regex=/control-([0-9]+)-section-([0-9]+)/;var matchs=regex.exec(that.attr("id")),sectionid=parseInt(matchs[1]),sectionsection=parseInt(matchs[2]);matchs=(regex=/level-([0-9]+)/).exec(that.attr("class"));var level=parseInt(matchs[1]);log.debug("Working for flex section "+sectionsection+" of id "+sectionid);var url=config.wwwroot+"/theme/klassplace/sections/ajax/register.php?";if(url+="sectionid="+sectionid,!hide){var parentid=that.closest("li").parent().closest("li").attr("id");$.each($("#"+parentid+" .flexcontrol.level-"+level),(function(index,value){$(value).attr("id")!=that.attr("id")&&$(value).trigger("click",!0)}))}if($("#section-"+sectionsection).hasClass("expanded")||!0===hide)$("#section-"+sectionsection).addClass("collapsed"),$("#section-"+sectionsection).removeClass("expanded"),log.debug("Changing section #section-title-"+sectionsection+" to false"),$("#section-title-"+sectionsection).attr("aria-expanded","false"),$("#section-"+sectionsection+" > .content > .section-content").addClass("collpased"),$("#section-"+sectionsection+" > .content > .section-content").removeClass("expanded"),hide=1;else{$("#section-"+sectionsection).addClass("expanded"),$("#section-"+sectionsection).removeClass("collapsed"),log.debug("Changing section #section-title-"+sectionsection+" to true"),$("#section-title-"+sectionsection).attr("aria-expanded","true"),$("#section-"+sectionsection+" > .content > .section-content").addClass("expanded"),$("#section-"+sectionsection+" > .content > .section-content").removeClass("collapsed"),hide=0;var offset=that.offset();offset.top-=70,$("html, body").animate({scrollTop:offset.top,scrollLeft:0})}return url+="&hide="+hide,$.get(url,(function(){})),!1},processglobal:function(e){e.stopPropagation(),e.preventDefault();var that=$(this),what=/flexsections-control-([a-z]+)/.exec(that.attr("id"))[1],url=config.wwwroot+"/theme/klassplace/sections/ajax/register.php?";switch(url+="id="+flexsection_control.courseid,url+="&what="+what,what){case"collapseall":$(".section.sub").removeClass("expanded"),$(".section.sub").addClass("collapsed"),$(".section-content").addClass("collpased"),$(".section-content").removeClass("expanded"),$(".section-title").attr("aria-expanded","false");break;case"expandall":$(".section").removeClass("collapsed"),$(".section").addClass("expanded"),$(".section-content").addClass("expanded"),$(".section-content").removeClass("collapsed"),$(".section-title").attr("aria-expanded","true");break;case"map":$(".section").removeClass("collapsed"),$(".section").addClass("expanded"),$(".section-content").removeClass("expanded"),$(".section-content").addClass("collapsed"),$(".section-title").attr("aria-expanded","false"),$(".section.isleaf").addClass("expanded"),$(".section.isleaf").removeClass("collapsed"),$(".section.isleaf .section-title").attr("aria-expanded","true")}$.get(url)},togglekeyreceiver:function(e){var that=$(this);if(13==e.keyCode||32==e.keyCode){var sectionid=that.closest("li").attr("id").replace("section-",""),flexcontrol=that.find("#section-title-"+sectionid+" > div.flexcontrol");$.proxy(flexsection_control.togglestate,flexcontrol)(e)}}};return flexsection_control}));

//# sourceMappingURL=flex_section_control.min.js.map