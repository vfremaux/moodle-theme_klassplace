{"version":3,"file":"spdrawer.min.js","sources":["../src/spdrawer.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Contain the logic for a drawer.\n *\n * @copyright  2021 Valery Fremaux, Nicolas Maligue\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine(['jquery', 'core/custom_interaction_events', 'core/log'],\n     function($, CustomEvents, Log) {\n\n    var SELECTORS = {\n        TOGGLE_REGION: '[data-region=\"spdrawer-toggle\"]',\n        TOGGLE_ACTION: '[data-action=\"toggle-spdrawer\"]',\n        TOGGLE_TARGET: 'aria-controls',\n        TOGGLE_SIDE: 'right',\n        BODY: 'body',\n        SECTION: '.list-group-item[href*=\"#section-\"]'\n    };\n\n    /**\n     * Constructor for the Drawer.\n     */\n    var SPDrawer = function() {\n\n        if (!$(SELECTORS.TOGGLE_REGION).length) {\n            Log.debug('Page is missing a spdrawer region');\n        }\n        if (!$(SELECTORS.TOGGLE_ACTION).length) {\n            Log.debug('Page is missing a spdrawer toggle link');\n        }\n        $(SELECTORS.TOGGLE_REGION).each(function(index, ele) {\n            var trigger = $(ele).find(SELECTORS.TOGGLE_ACTION);\n            var drawerid = trigger.attr('aria-controls');\n            var drawer = $(document.getElementById(drawerid));\n            var hidden = trigger.attr('aria-expanded') == 'false';\n            var side = trigger.attr('data-side');\n            var body = $(SELECTORS.BODY);\n\n            drawer.on('mousewheel DOMMouseScroll', this.preventPageScroll);\n\n            if (!hidden) {\n                body.addClass('spdrawer-open-' + side);\n                trigger.attr('aria-expanded', 'true');\n            } else {\n                trigger.attr('aria-expanded', 'false');\n            }\n        }.bind(this));\n\n        this.registerEventListeners();\n        var small = $(document).width() < 768;\n        if (small) {\n            this.closeAll();\n        }\n    };\n\n    SPDrawer.prototype.closeAll = function() {\n        $(SELECTORS.TOGGLE_REGION).each(function(index, ele) {\n            var trigger = $(ele).find(SELECTORS.TOGGLE_ACTION);\n            var side = trigger.attr('data-side');\n            var body = $(SELECTORS.BODY);\n            var drawerid = trigger.attr('aria-controls');\n            var drawer = $(document.getElementById(drawerid));\n            var preference = trigger.attr('data-preference');\n\n            trigger.attr('aria-expanded', 'false');\n            body.removeClass('drawer-open-' + side);\n            drawer.attr('aria-hidden', 'true');\n            drawer.addClass('closed');\n            M.util.set_user_preference(preference, 'false');\n        });\n    };\n\n    /**\n     * Open / close the blocks drawer.\n     *\n     * @method toggleDrawer\n     * @param {Event} e\n     */\n    SPDrawer.prototype.toggleDrawer = function(e) {\n        var trigger = $(e.target).closest('[data-action=toggle-spdrawer]');\n        var drawerid = trigger.attr('aria-controls');\n        var drawer = $(document.getElementById(drawerid));\n        var body = $(SELECTORS.BODY);\n        var side = trigger.attr('data-side');\n        var preference = trigger.attr('data-preference');\n\n        body.addClass('drawer-ease');\n        var open = trigger.attr('aria-expanded') == 'true';\n        if (!open) {\n            // Open.\n            trigger.attr('aria-expanded', 'true');\n            drawer.attr('aria-hidden', 'false');\n            drawer.focus();\n            body.addClass('drawer-open-' + side);\n            drawer.removeClass('closed');\n            trigger.children('i').removeClass('fa-arrow-left');\n            trigger.children('i').addClass('fa-arrow-right');\n            M.util.set_user_preference(preference, 'true');\n        } else {\n            // Close.\n            body.removeClass('drawer-open-' + side);\n            trigger.attr('aria-expanded', 'false');\n            drawer.attr('aria-hidden', 'true');\n            drawer.addClass('closed');\n            trigger.children('i').removeClass('fa-arrow-right');\n            trigger.children('i').addClass('fa-arrow-left');\n            M.util.set_user_preference(preference, 'false');\n        }\n    };\n\n    /**\n     * Prevent the page from scrolling when the drawer is at max scroll.\n     *\n     * @method preventPageScroll\n     * @param  {Event} e\n     */\n    SPDrawer.prototype.preventPageScroll = function(e) {\n        var delta = e.wheelDelta || (e.originalEvent && e.originalEvent.wheelDelta) || -e.originalEvent.detail,\n            bottomOverflow = (this.scrollTop + $(this).outerHeight() - this.scrollHeight) >= 0,\n            topOverflow = this.scrollTop <= 0;\n\n        if ((delta < 0 && bottomOverflow) || (delta > 0 && topOverflow)) {\n            e.preventDefault();\n        }\n    };\n\n    /**\n     * Set up all of the event handling for the modal.\n     *\n     * @method registerEventListeners\n     */\n    SPDrawer.prototype.registerEventListeners = function() {\n\n        $(SELECTORS.TOGGLE_ACTION).each(function(index, element) {\n            CustomEvents.define($(element), [CustomEvents.events.activate]);\n            $(element).on(CustomEvents.events.activate, function(e, data) {\n                this.toggleDrawer(data.originalEvent);\n                data.originalEvent.preventDefault();\n            }.bind(this));\n        }.bind(this));\n\n        $(SELECTORS.SECTION).click(function() {\n            var small = $(document).width() < 768;\n            if (small) {\n                this.closeAll();\n            }\n        }.bind(this));\n    };\n\n    return {\n        'init': function() {\n            return new SPDrawer();\n        }\n    };\n});\n"],"names":["define","$","CustomEvents","Log","SELECTORS","SPDrawer","length","debug","each","index","ele","trigger","find","drawerid","attr","drawer","document","getElementById","hidden","side","body","on","this","preventPageScroll","addClass","bind","registerEventListeners","width","closeAll","prototype","preference","removeClass","M","util","set_user_preference","toggleDrawer","e","target","closest","children","focus","delta","wheelDelta","originalEvent","detail","bottomOverflow","scrollTop","outerHeight","scrollHeight","topOverflow","preventDefault","element","events","activate","data","click"],"mappings":"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"}